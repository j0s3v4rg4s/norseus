@let isExpanded = layoutStore.isExpanded();
@let isMobileOpen = layoutStore.isMobileOpen();
@let visibleLargeMenu = layoutStore.visibleLargeMenu();

<aside
  class="fixed flex flex-col top-0 px-5 left-0 bg-background dark:bg-gray-900 dark:border-gray-800 text-gray-900 h-screen transition-all duration-300 ease-in-out z-50 border-r border-gray-200"
  [class]="{
    'w-[290px]': visibleLargeMenu,
    'w-[90px]': !visibleLargeMenu,
    'translate-x-0': isMobileOpen,
    '-translate-x-full': !isMobileOpen,
    'xl:translate-x-0': true,
  }"
>
  <div
    class="flex"
    [class]="{
      'xl:justify-center': !isExpanded,
      'justify-start': isExpanded,
    }"
  >
    <div class="pt-4 h-[62px] box-content">
      @if (layoutStore.logo()) {
        <a routerLink="/">
          <img [ngSrc]="layoutStore.logo()!" alt="" width="249" height="62" class="aspect-[4/1] object-contain" />
        </a>
      }
    </div>
  </div>

  <div class="flex flex-col overflow-y-auto duration-300 ease-linear no-scrollbar flex-1">
    <nav class="flex flex-col gap-4 mt-8">
      <h2
        class="mb-4 text-xs uppercase flex leading-[20px] text-gray-400"
        [class]="{
          'xl:justify-center': !isExpanded,
          'justify-start': isExpanded,
        }"
      >
        @if (visibleLargeMenu) {
          MENU
        } @else {
          <i class="material-symbols-rounded size-6">more_horiz</i>
        }
      </h2>
      <ul class="flex flex-col gap-1">
        @for (item of layoutStore.menuItems(); track $index; let i = $index) {
          @if (item.subItems) {
            <button
              class="menu-item group cursor-pointer"
              (click)="toggleSubmenu('main', i)"
              [class.menu-item-active]="openSubmenu() === 'main-' + i"
              [class.menu-item-inactive]="openSubmenu() !== 'main-' + i"
            >
              <i class="material-symbols-rounded menu-item-icon">{{ item.icon }}</i>
              <span>{{ item.label }}</span>
              <i
                class="material-symbols-rounded menu-item-icon ml-auto transition-transform duration-200"
                [class.rotate-0]="openSubmenu() !== 'main-' + i"
                [class.rotate-90]="openSubmenu() === 'main-' + i"
              >
                chevron_right
              </i>
            </button>
            <div
              class="overflow-hidden sub-menu-container relative"
              [class]="{ 'h-max': openSubmenu() === 'main-' + i, 'h-0': openSubmenu() !== 'main-' + i }"
            >
              <ul class="mt-2 space-y-1 ml-9">
                @for (subItem of item.subItems; track $index; let j = $index) {
                  <li>
                    @if (subItem.isExternal) {
                      <a
                        class="menu-item group cursor-pointer menu-item-inactive"
                        [href]="subItem.route"
                        target="_blank"
                        routerLinkActive="menu-item-active"
                      >
                        <i class="material-symbols-rounded menu-item-icon">{{ subItem.icon }}</i>
                        <span>{{ subItem.label }}</span>
                      </a>
                    } @else {
                      <a
                        class="menu-item group cursor-pointer menu-item-inactive"
                        [routerLink]="subItem.route"
                        routerLinkActive="menu-item-active"
                      >
                        <i class="material-symbols-rounded menu-item-icon">{{ subItem.icon }}</i>
                        <span>{{ subItem.label }}</span>
                      </a>
                    }
                  </li>
                }
              </ul>
            </div>
          } @else {
            @if (item.isExternal) {
              <a
                class="menu-item group cursor-pointer menu-item-inactive"
                [href]="item.route"
                target="_blank"
                routerLinkActive="menu-item-active"
              >
                <i class="material-symbols-rounded menu-item-icon">{{ item.icon }}</i>
                <span>{{ item.label }}</span>
              </a>
            } @else {
              <a
                class="menu-item group cursor-pointer menu-item-inactive"
                [routerLink]="item.route"
                routerLinkActive="menu-item-active"
              >
                <i class="material-symbols-rounded menu-item-icon">{{ item.icon }}</i>
                <span>{{ item.label }}</span>
              </a>
            }
          }
        }
      </ul>
    </nav>
  </div>
</aside>
