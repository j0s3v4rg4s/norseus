<div class="container">
  <div class="flex items-center mb-6">
    <h1 class="text-2xl font-bold">Crear nuevo permiso</h1>
  </div>

  <div class="max-w-3xl mx-auto">
    <div class="bg-white rounded-lg shadow-lg p-4 mb-8">
      <form [formGroup]="form" class="mb-8">
        <div class="grid gap-3">
          <label for="role-name" class="label">Nombre del rol</label>
          <input
            class="input"
            id="role-name"
            formControlName="roleName"
            type="text"
            placeholder="Ingrese el nombre del rol"
            [attr.aria-invalid]="form.get('roleName')?.invalid && form.get('roleName')?.touched"
          />
        </div>

        <div class="flex flex-col gap-4 items-stretch sm:flex-row sm:items-end mt-4">
          <div class="grid gap-3 w-full sm:w-auto">
            <label for="action-select" class="label">Acción</label>
            <ui-select
              id="action-select"
              formControlName="action"
              placeholder="Seleccionar acción"
            >
              @for (action of actions; track action) {
                <ui-option [value]="action">
                  {{ actionsDictionary[action] }}
                </ui-option>
              }
            </ui-select>
          </div>

          <div class="grid gap-3 w-full sm:w-auto">
            <label for="section-select" class="label">Sección</label>
            <ui-select
              id="section-select"
              formControlName="section"
              placeholder="Seleccionar sección"
            >
              @for (section of sections; track section) {
                <ui-option [value]="section">
                  {{ sectionsDictionary[section] }}
                </ui-option>
              }
            </ui-select>
          </div>

          <div class="w-full sm:grow">
            <button
              class="btn w-full sm:w-auto"
              type="button"
              (click)="addPermissionAction()"
            >
              Agregar acción
            </button>
          </div>
        </div>
        @if (store.duplicateError()) {
          <div class="text-red-600 text-sm mt-2">{{ store.errorMessage() }}</div>
        }
      </form>

      @if (store.permissions().length) {
        <div class="overflow-x-auto rounded-lg border border-slate-300 overflow-hidden">
          <table cdk-table [dataSource]="store.permissions()" class="min-w-full bg-slate-50">
            <ng-container cdkColumnDef="action">
              <th cdk-header-cell *cdkHeaderCellDef class="px-6 py-4 text-left font-semibold text-slate-700 bg-slate-50">
                Acción
              </th>
              <td
                cdk-cell
                *cdkCellDef="let element; let i = index"
                class="px-6 py-4 align-middle text-slate-700 bg-white"
                >
                {{ getActionLabel(element?.action) }}
              </td>
            </ng-container>
            <ng-container cdkColumnDef="section">
              <th cdk-header-cell *cdkHeaderCellDef class="px-6 py-4 text-left font-semibold text-slate-700 bg-slate-50">
                Sección
              </th>
              <td
                cdk-cell
                *cdkCellDef="let element; let i = index"
                class="px-6 py-4 align-middle text-slate-700 bg-white"
                >
                {{ getSectionLabel(element?.section) }}
              </td>
            </ng-container>
            <ng-container cdkColumnDef="delete">
              <th
                cdk-header-cell
                *cdkHeaderCellDef
                class="px-6 py-4 text-center font-semibold text-blue-600 bg-slate-50"
              ></th>
              <td cdk-cell *cdkCellDef="let element; let i = index" class="px-6 py-4 text-center bg-white">
                <button type="button" (click)="removePermissionAction(i)" class="text-destructive">
                  <span class="material-symbols-rounded">delete</span>
                </button>
              </td>
            </ng-container>
            <tr cdk-header-row *cdkHeaderRowDef="displayedColumns" class="border-b border-slate-300"></tr>
            <tr
              cdk-row
              *cdkRowDef="let row; let i = index; columns: displayedColumns"
              class="border-b border-slate-300 last:border-b-0"
            ></tr>
          </table>
        </div>
      }
    </div>
    @if (store.statusSaveMessage()) {
      <div class="text-red-400 text-sm mb-2">{{ store.statusSaveMessage() }}</div>
    }
    <div class="flex justify-between items-center">
      <button class="btn-outline" routerLink="/home/permissions">Cancelar</button>
      <button
        class="btn"
        (click)="saveRole()"
        ui-button
        [isLoading]="store.isLoading()"
      >
        Guardar
      </button>
    </div>
  </div>
</div>
